{% extends "seller/base.html" %}
{% load static %}
{% block content %}

<section class="content">
    <div class="body_scroll">
        <div class="block-header">
            <div class="row">
                <div class="col-lg-7 col-md-6 col-sm-12">
                    <h2>Sub-Category Add</h2>
                </div>
                <div class="col-lg-5 col-md-6 col-sm-12">
                    <button class="btn btn-primary btn-icon float-right right_icon_toggle_btn" type="button">
                        <i class="zmdi zmdi-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>

        <div class="container-fluid">
            <div class="row clearfix">
                <div class="col-lg-12 col-md-12 col-sm-12">
                    <div class="card">
                        <div class="body">

                            <form id="subCategoryForm" enctype="multipart/form-data">
                                {% csrf_token %}

                                <div class="form-group">
                                    <label>Category Name</label>
                                    <select id="category_id" name="category_id" class="selectpicker" data-width="100%">

                                        <option value="">-- Select Category --</option>
                                        {% for category in categories %}
                                        <option value="{{ category.id }}">{{ category.category_name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>


                                <div class="form-group">
                                    <label>Sub-Category Name</label>
                                    <input type="text" id="sub_category_name" name="sub_category_name"
                                        class="form-control">
                                </div>

                                <div class="form-group">
                                    <label>Description</label>
                                    <textarea id="description" name="description" class="form-control"></textarea>
                                </div>

                                <div class="form-group">
                                    <label>Sub-Category Image</label>
                                    <input type="file" id="image" name="image" class="form-control">
                                </div>

                                <button type="submit" class="btn btn-primary">Add Sub-Category</button>
                            </form>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
  document.getElementById("subCategoryForm").addEventListener("submit", function(e) {
    e.preventDefault();

    let formData = new FormData(this);

    // Clear all <small> error messages dynamically
    document.querySelectorAll("small[id^='error_']").forEach(el => el.innerHTML = "");

    fetch("{% url 'subcategory' %}", {
        method: "POST",
        body: formData,
        headers: {
            "X-CSRFToken": "{{ csrf_token }}"
        }
    })
    .then(res => res.json())
    .then(data => {

        if (data.status === "error") {
            // Loop through all errors
            for (const [field, message] of Object.entries(data.errors)) {

                // Display error in small tag if exists
                const errorElement = document.getElementById(`error_${field}`);
                if (errorElement) {
                    errorElement.innerHTML = message;
                }

                // Show toastr error
                toastr.error(message, "Error");
            }
        } else if (data.status === "success") {
            toastr.success("Sub-Category Created Successfully.", "Success");

            // Reset form
            this.reset();
        }
    });
});


</script>

{% endblock %}