{% extends "seller/base.html" %}
{% load static %}
{% block content %}

<section class="content">
    <div class="body_scroll">
        <div class="block-header">
            <div class="row">
                <div class="col-lg-7 col-md-6 col-sm-12">
                    <h2>Sub-Category Add</h2>
                </div>
                <div class="col-lg-5 col-md-6 col-sm-12">
                    <button class="btn btn-primary btn-icon float-right right_icon_toggle_btn" type="button">
                        <i class="zmdi zmdi-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>

        <div class="container-fluid">
            <div class="row clearfix">
                <div class="col-lg-12 col-md-12 col-sm-12">
                    <div class="card">
                        <div class="body">

                            <form id="subCategoryForm" enctype="multipart/form-data">
                                {% csrf_token %}

                                <div class="form-group">
                                    <label>Category Name</label>
                                    <select id="category_id" name="category_id" class="selectpicker" data-width="100%">

                                        <option value="">-- Select Category --</option>
                                        {% for category in categories %}
                                        <option value="{{ category.id }}">{{ category.category_name }}</option>
                                        {% endfor %}
                                    </select>
                                    <small id="error_category_id" style="color:red;"></small>
                                </div>


                                <div class="form-group">
                                    <label>Sub-Category Name</label>
                                    <input type="text" id="sub_category_name" name="sub_category_name"
                                        class="form-control">
                                    <small id="error_sub_category_name" style="color:red;"></small>
                                </div>

                                <div class="form-group">
                                    <label>Description</label>
                                    <textarea id="description" name="description" class="form-control"></textarea>
                                </div>

                                <div class="form-group">
                                    <label>Sub-Category Image</label>
                                    <input type="file" id="image" name="image" class="form-control">
                                    <small id="error_image" style="color:red;"></small>
                                </div>

                                <button type="submit" class="btn btn-primary">Add Sub-Category</button>
                            </form>

                            <small id="success_message" style="color: green; font-weight: 500;"></small>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<script>
    $('.selectpicker').selectpicker();
</script>


<script>
    document.getElementById("subCategoryForm").addEventListener("submit", function (e) {
        e.preventDefault();

        let formData = new FormData(this);

        document.getElementById("error_category_id").innerHTML = "";
        document.getElementById("error_sub_category_name").innerHTML = "";
        document.getElementById("error_image").innerHTML = "";

        fetch("{% url 'subcategory' %}", {
            method: "POST",
            body: formData,
            headers: {
                "X-CSRFToken": "{{ csrf_token }}"
            }
        })
            .then(res => res.json())
            .then(data => {

                if (data.status === "error") {

                    if (data.errors.category_id) {
                        document.getElementById("error_category_id").innerHTML = data.errors.category_id;
                    }

                    if (data.errors.sub_category_name) {
                        document.getElementById("error_sub_category_name").innerHTML = data.errors.sub_category_name;
                    }

                    if (data.errors.image) {
                        document.getElementById("error_image").innerHTML = data.errors.image;
                    }

                } else if (data.status === "success") {

                    document.getElementById("success_message").innerHTML =
                        "Sub-Category Created Successfully âœ”";

                    document.getElementById("category_id").value = "";
                    document.getElementById("sub_category_name").value = "";
                    document.getElementById("description").value = "";
                    document.getElementById("image").value = "";

                    setTimeout(() => {
                        document.getElementById("success_message").innerHTML = "";
                    }, 3000);
                }
            });
    });
</script>

{% endblock %}